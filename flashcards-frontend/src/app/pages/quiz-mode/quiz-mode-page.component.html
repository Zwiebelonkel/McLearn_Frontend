<a routerLink="/stacks" class="back-link">â† {{ 'back' | translate }}</a>

<div class="container" (touchstart)="handleTouchStart($event)" (touchend)="handleTouchEnd($event)">

  <!-- Progress Container - matching study page style -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="getProgressPercent()"></div>
    </div>
    <p class="progress-label">{{ getProgressText() }}</p>
  </div>

  <!-- Quiz Completed Screen -->
  <ng-container *ngIf="quizCompleted(); else quizActive">
    <div class="completion-screen">
      <h2>ğŸ‰ {{ 'quiz_completed' | translate }}</h2>
      <p>{{ 'quiz_completed_message' | translate }}</p>
      
      <div class="ratings">
        <button (click)="restartQuiz()" class="btn btn-primary">{{ 'restart_quiz' | translate }}</button>
        <button (click)="exitQuiz()" class="btn btn-secondary">{{ 'back_to_study' | translate }}</button>
      </div>
    </div>
  </ng-container>

  <!-- Active Quiz - matching study page structure -->
  <ng-template #quizActive>
    <ng-container *ngIf="currentCard; else empty">
      <div class="card-wrapper">
        <div
          class="card"
          [class.flipped]="showBack()"
          (click)="flip()"
        >
          <div class="card-inner">
            <!-- Front Side -->
            <div class="card-front">
              <img 
                *ngIf="currentCard.front_image" 
                [src]="currentCard.front_image" 
                alt="Card image" 
                class="card-image">
              <p>{{ currentCard.front }}</p>
            </div>

            <!-- Back Side -->
            <div class="card-back">
              <div [innerHTML]="renderMarkdown(currentCard.back || '')"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons - matching study page ratings style -->
      <div *ngIf="showBack() && !isTransitioning()">
        <div class="ratings">
          <button (click)="markIncorrect()" class="btn btn-danger">
            âŒ {{ 'incorrect' | translate }}
          </button>
          <button (click)="markCorrect()" class="btn btn-success">
            âœ… {{ 'correct' | translate }}
          </button>
        </div>
      </div>
    </ng-container>

    <ng-template #empty>
      <p>{{ 'no_card_found' | translate }}</p>
    </ng-template>
  </ng-template>

  <!-- Share button - matching study page -->
  <div class="footer-actions">
    <button *ngIf="stack()" (click)="shareStack()" class="share-button" title="Share this stack">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
      {{ 'share' | translate }}
    </button>
  </div>
</div>